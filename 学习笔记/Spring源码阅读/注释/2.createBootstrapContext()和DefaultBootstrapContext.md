```java
private DefaultBootstrapContext createBootstrapContext() {
   DefaultBootstrapContext bootstrapContext = new DefaultBootstrapContext();
   this.bootstrapRegistryInitializers.forEach((initializer) -> initializer.initialize(bootstrapContext));
   return bootstrapContext;
}
```

### DefaultBootstrapContext

> 结构图：
>
> ![image-20230414142650633](https://xmls-typora-pic.oss-cn-shanghai.aliyuncs.com/pic/image-20230414142650633.png)
>
> 实际上是实现了`BootstrapRegistry`和`BootstrapContext`两个接口[相关](./3.bootstrapRegistryInitializers.md)

#### `register`、`registerIfAbsent`

```java
@Override
public <T> void register(Class<T> type, InstanceSupplier<T> instanceSupplier) {
   register(type, instanceSupplier, true);
}

@Override
public <T> void registerIfAbsent(Class<T> type, InstanceSupplier<T> instanceSupplier) {
    register(type, instanceSupplier, false);
}
/**
 * @param type 类型
 * @param instanceSupplier 类型的实例化提供者
 * @param replaceExisting 如果存在是否替换
 */
private <T> void register(Class<T> type, InstanceSupplier<T> instanceSupplier, boolean replaceExisting) {
    Assert.notNull(type, "Type must not be null");
    Assert.notNull(instanceSupplier, "InstanceSupplier must not be null");
    //控制线程安全
    synchronized (this.instanceSuppliers) {
        //检查instanceSuppliers中是否已经注册过"实例化提供(instanceSupplier)"
        boolean alreadyRegistered = this.instanceSuppliers.containsKey(type);
        //如果没有注册 或者 已经存在也替换
        if (replaceExisting || !alreadyRegistered) {
            //判断如果类型已经实例化，则抛出异常
            Assert.state(!this.instances.containsKey(type), () -> type.getName() + " has already been created");
            //将类型和 实例化提供者 放进 class-instanceSupplier map中
            this.instanceSuppliers.put(type, instanceSupplier);
        }
    }
}
```

#### `isRegistered`

```java
//判断这个类型是否已经存在于 class-instanceSupplier map中
@Override
public <T> boolean isRegistered(Class<T> type) {
    synchronized (this.instanceSuppliers) {
        return this.instanceSuppliers.containsKey(type);
    }
}
```

#### `getRegisteredInstanceSupplier`

```java
//根据类型获取 类型实例化的提供者
@Override
@SuppressWarnings("unchecked")
public <T> InstanceSupplier<T> getRegisteredInstanceSupplier(Class<T> type) {
   synchronized (this.instanceSuppliers) {
      return (InstanceSupplier<T>) this.instanceSuppliers.get(type);
   }
}
```